<!DOCTYPE html>
<html>
  <head>
    <title>Account Handler</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module" src="./activitypub-actor.js"></script>
  </head>
  <body>
    <header>
      <h1>Account Handler</h1>
      <nav>
        <ul>
          <li><a href="javascript:registerAcctHandler()">Register</a></li>
        </ul>
        <form onsubmit="handleActorSearch()" method="get">
          <label for="actor-search">Actor:</label>
          <input type="search" id="actor-search" name="q" />
          <button>Show</button>
        </form>
      </nav>
    </header>
    <main>
      <section id="account">
      </section>
    </main>
    <script>
      function registerAcctHandler() {
        const loc = document.location.origin + document.location.pathname;
        console.log("Registering protocol handler");
        const handler = `${loc}?q=%s`
        console.log(handler)
        navigator.registerProtocolHandler(
          "web+acct",
          handler
        );
      }

      function handleActorSearch() {
        const actor = document.getElementById("actor-search").value;
        if (!actor.startsWith("web+acct:")) {
          actor = "web+acct:" + actor;
        }
        const url = new URL(document.location.origin + document.location.pathname);
        url.searchParams.set("q", actor);
        document.location = url;
        return false;
      }

      window.onload = () => {

        const address = new URLSearchParams(document.location.search).get("q");

        if (address && address.startsWith("web+acct:")) {
          const acct = address.slice(4) // take off the web+ part
          const handler = document.getElementById("handler")
          handler.webfinger = acct
        }
      }
    </script>
  </body>
</html>